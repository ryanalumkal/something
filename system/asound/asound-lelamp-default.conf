# ALSA configuration for LeLamp
# Default configuration: USB-C Speaker + Innomaker USB Camera Microphone
# Standardized on 48kHz for both playback and capture
# Playback: USB-C Speaker (48kHz native)
# Capture: Innomaker USB Camera (48kHz - device supports 22050/32000/48000/96000)
#
# This config provides abstract device names that applications should use:
#   - lelamp_playback: For audio output (livekit, spotifyd, sox, etc.)
#   - lelamp_capture: For microphone input (livekit, VAD, recording, etc.)
#
# Uses dmix for playback and dsnoop for capture

# Set lelamp abstract devices as system defaults
pcm.!default {
    type asym
    playback.pcm "lelamp_playback"
    capture.pcm "lelamp_capture"
}

ctl.!default {
    type hw
    card Device
}

# ==============================================================================
# ABSTRACT DEVICE LAYER - Applications should use these device names
# ==============================================================================

# lelamp_playback - Abstract playback device (use this in all applications)
pcm.lelamp_playback {
    type plug
    slave.pcm "hw_playback_dmix"
}

# lelamp_capture - Abstract capture device (use this in all applications)
pcm.lelamp_capture {
    type plug
    slave.pcm "hw_capture_dsnoop"
}

# ==============================================================================
# HARDWARE LAYER - Maps abstract devices to physical hardware
# ==============================================================================

# Hardware playback - USB-C Speaker with dmix for sharing
# Using 24kHz internally, plug converts to 48kHz for hardware
pcm.hw_playback_dmix {
    type dmix
    ipc_key 1024
    ipc_perm 0666
    slave {
        pcm {
            type hw
            card Device
            device 0
        }
        rate 48000
        format S16_LE
        channels 2
        period_time 0
        period_size 2048
        buffer_size 8192
    }
    bindings {
        0 0
        1 1
    }
}

# Resampling layer for 24kHz to hardware 48kHz
pcm.lelamp_playback_24k {
    type rate
    slave {
        pcm "hw_playback_dmix"
        rate 48000
    }
    converter "samplerate_best"
}

# Hardware capture - Innomaker USB Camera mic with dsnoop at 48kHz
# Note: Innomaker U20CAM supports 22050, 32000, 48000, 96000 Hz (NOT 24000!)
pcm.hw_capture_dsnoop {
    type dsnoop
    ipc_key 1025
    ipc_perm 0666
    slave {
        pcm {
            type hw
            card InnomakerU20CAM
            device 0
        }
        rate 48000
        format S16_LE
        channels 2
        period_size 1024
        buffer_size 4096
    }
    bindings {
        0 0
        1 1
    }
}
